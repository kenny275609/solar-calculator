# 太陽光電規劃系統

一個完整的太陽光電系統規劃計算工具，整合 Supabase 資料庫進行專案管理。

## 功能特色

### 📊 計算功能
- **太陽能板陣列規劃**：自動計算串並聯配置
- **逆變器選型**：驗證逆變器規格是否符合需求
- **線徑規劃**：計算 DC/AC 側線徑與電壓降
- **保護元件規劃**：計算保險絲與斷路器規格

### 🔧 設備資料庫
- **太陽能板選單**：從 Supabase 資料庫選擇太陽能板型號，自動填入規格
- **逆變器選單**：從 Supabase 資料庫選擇逆變器型號，自動填入規格
- **手動輸入**：仍可手動輸入設備規格

### 💾 專案管理
- **保存專案**：將計算結果保存至 Supabase
- **載入專案**：從資料庫載入已保存的專案
- **專案列表**：查看所有已保存的專案
- **刪除專案**：管理不需要的專案

### 📄 報表功能
- **PDF 匯出**：生成完整的計算報表

## 系統需求

- 現代瀏覽器（Chrome、Firefox、Edge、Safari）
- Supabase 專案（已設定資料庫結構）

## 安裝步驟

### 1. 設定 Supabase 資料庫

請參考 [SUPABASE_SETUP.md](./SUPABASE_SETUP.md) 文件，在 Supabase 中建立必要的資料表。

**重要**：除了專案資料表外，還需要執行 `supabase-equipment-schema.sql` 建立太陽能板和逆變器資料表。

### 2. 確認 Supabase 設定

確認 `supabase-config.js` 中的設定正確：

```javascript
const SUPABASE_URL = 'https://ntlmothsjvhdvcykcvex.supabase.co';
const SUPABASE_ANON_KEY = 'your-anon-key';
```

### 3. 開啟應用程式

直接在瀏覽器中開啟 `index.html` 檔案，或使用本地伺服器：

```bash
# 使用 Python
python -m http.server 8000

# 使用 Node.js (需要安裝 http-server)
npx http-server

# 使用 PHP
php -S localhost:8000
```

然後在瀏覽器中訪問 `http://localhost:8000`

## 使用說明

### 基本計算流程

1. **輸入基本系統參數**
   - 總系統容量 (kWp)
   - 電網電壓 (V)
   - 環境溫度範圍 (°C)

2. **選擇或輸入太陽能板規格**
   - **方式一（推薦）**：從下拉選單選擇太陽能板型號，系統會自動填入所有規格
   - **方式二**：手動輸入以下規格
     - 單片功率 (W)
     - 最大功率點電壓/電流 (V/A)
     - 開路電壓/短路電流 (V/A)
     - 溫度係數 (%/°C)

3. **選擇或輸入逆變器規格**
   - **方式一（推薦）**：從下拉選單選擇逆變器型號，系統會自動填入所有規格
   - **方式二**：手動輸入以下規格
     - 最大輸入電壓 (V)
     - MPPT 電壓範圍 (V)
     - 最大輸入電流 (A)
     - 額定輸出功率/電流 (kW/A)

4. **輸入線路參數**
   - DC/AC 線路長度 (m)
   - 線材周圍溫度 (°C)
   - 導體電阻率 (Ω·mm²/m)

5. **執行計算**
   - 點擊「🚀 開始計算」按鈕
   - 系統會自動計算並顯示結果

### 專案管理

#### 保存專案
1. 完成計算後，點擊「💾 保存專案」
2. 輸入專案名稱（必填）和描述（選填）
3. 點擊「保存」按鈕

#### 載入專案
1. 點擊「📂 載入專案」
2. 從列表中選擇要載入的專案
3. 點擊「載入」按鈕
4. 系統會自動填入所有參數並顯示計算結果

#### 查看專案列表
1. 點擊「📋 專案列表」
2. 查看所有已保存的專案
3. 可以載入或刪除專案

#### 新建專案
1. 點擊「➕ 新建專案」
2. 確認後會清空當前表單和結果

### 匯出報表

1. 完成計算後，點擊「📄 匯出 PDF 報表」
2. 系統會開啟新視窗顯示完整報表
3. 使用瀏覽器的列印功能儲存為 PDF

## 計算公式說明

### 陣列規劃

- **最大串聯片數**：`Nmax = floor(VinvMax / VocTmin)`
- **最小串聯片數**：`Nmin = ceil(VinvMpptMin / VmppTmax)`
- **溫度修正電壓**：`VocTmin = Voc × (1 + αVoc × (Tmin - 25))`
- **溫度修正電流**：`IscTmax = Isc × (1 + αIsc × (Tmax - 25))`

### 線徑計算

- **電壓降**：`ΔV% = (2 × L × I × ρ) / (A × V) × 100`
- **線徑選擇**：根據載流量表選擇合適的線徑

### 保護元件

- **保險絲額定電流**：`Ifuse ≥ Isc × 1.25`
- **斷路器額定電流**：`Ibreaker ≥ Imax × 1.25`

## 技術架構

### 前端技術
- 純 HTML/CSS/JavaScript
- 響應式設計
- 模態框 UI

### 後端整合
- Supabase REST API
- JSONB 資料儲存
- Row Level Security (RLS)

### 資料結構
- 專案資料儲存在 Supabase `projects` 資料表
- 輸入參數和計算結果以 JSONB 格式儲存

## 檔案結構

```
.
├── index.html                      # 主應用程式檔案
├── supabase-config.js              # Supabase 客戶端設定
├── supabase-schema.sql             # 專案資料表結構
├── supabase-equipment-schema.sql   # 設備資料表結構（太陽能板、逆變器）
├── SUPABASE_SETUP.md               # Supabase 資料庫設定說明
└── README.md                       # 本文件
```

## 注意事項

1. **資料安全**：目前使用 anon key，所有用戶都可以讀寫所有專案。在生產環境中應設定更嚴格的安全政策。

2. **瀏覽器相容性**：建議使用最新版本的現代瀏覽器。

3. **計算精度**：計算結果僅供參考，實際應用時請諮詢專業工程師。

4. **資料備份**：建議定期備份 Supabase 資料庫。

## 疑難排解

### 無法連接到 Supabase
- 檢查網路連線
- 確認 Supabase URL 和 API Key 是否正確
- 查看瀏覽器控制台的錯誤訊息

### 無法保存專案
- 確認 Supabase 資料表已正確建立
- 檢查 RLS 政策設定
- 查看 Supabase Dashboard 的錯誤日誌

### 計算結果異常
- 檢查輸入參數是否合理
- 確認單位是否正確（kW vs W, V, A 等）
- 查看瀏覽器控制台是否有錯誤

### 下拉選單沒有資料
- 確認已執行 `supabase-equipment-schema.sql` 建立設備資料表
- 檢查資料表中是否有資料（可在 Supabase Dashboard 中查看）
- 重新整理頁面讓系統重新載入資料
- 查看瀏覽器控制台是否有錯誤訊息

## 授權

本專案僅供學習和參考使用。

## 聯絡資訊

如有問題或建議，請透過 GitHub Issues 回報。

